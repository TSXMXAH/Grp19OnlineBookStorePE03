@page "/"

@using Grp19OnlineBookStorePE03.Classes
@using Grp19OnlineBookStorePE03.Data
@using Microsoft.EntityFrameworkCore

@inject Grp19OnlineBookStorePE03Context DbContext

<style>
    .section {
        width: 90%;
        margin: 40px auto;
    }

        .section h1 {
            margin-bottom: 25px;
        }

    /* GRID LAYOUT */
    .card-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 30px;
    }

    .card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .card-cover {
        height: 200px;
        background: #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
        font-size: 14px;
    }

    .card-info {
        line-height: 1.6;
        margin-bottom: 20px;
    }

    .card-buttons {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .btn {
        background: red;
        color: white;
        border: none;
        padding: 10px;
        font-weight: bold;
        cursor: pointer;
        border-radius: 5px;
    }
</style>

<!-- Books -->
<div class="section">
    <h1>Top three picks for you!</h1>

    @if (topBooks == null)
    {
        <p>Loading books...</p>
    }
    else
    {
        <div class="card-grid">
            @foreach (var book in topBooks)
            {
                <div class="card">
                    <div class="card-cover">
                        <a href="@book.CoverUrl" target="_blank">
                            <img src="@book.CoverUrl" alt="Cover for @book.Title" />
                        </a>
                    </div>

                    <div class="card-info">
                        <strong>@book.Title</strong><br />
                        Author: @book.Author<br />
                        Category: @book.Category<br /><br />
                        <strong>$@book.Price</strong>
                    </div>

                    <div class="card-buttons">
                        <button class="btn">ADD TO CART</button>
                        <button class="btn">WISHLIST</button>
                    </div>
                </div>
                 }
        </div>
    }
</div>

<!-- Miscs-->
<div class="section">
    <h1>Other cool stuff you might like</h1>

    @if (topMisc == null)
    {
        <p>Loading items...</p>
    }
    else
    {
        <div class="card-grid">
            @foreach (var item in topMisc)
            {
                <div class="card">
                    <div class="card-cover">Item Image</div>

                    <div class="card-info">
                        <strong>@item.MiscName</strong><br />
                        Category: @item.Category<br /><br />
                        <strong>$@item.Price</strong>
                    </div>

                    <div class="card-buttons">
                        <button class="btn">ADD TO CART</button>
                        <button class="btn">WISHLIST</button>
                    </div>
                </div>
            }
        </div>
    }

</div>
@code {
    private List<Book>? topBooks;
    private List<Misc>? topMisc;

    protected override async Task OnInitializedAsync()
    {
        topBooks = await DbContext.Book
            .OrderBy(b => Guid.NewGuid())
            .Take(3)
            .ToListAsync();

        topMisc = await DbContext.Misc
            .OrderBy(m => Guid.NewGuid())
            .Take(3)
            .ToListAsync();
    }
}